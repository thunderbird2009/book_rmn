<!-- Medium Zoom for Images and SVGs -->
<script src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js"></script>

<style>
  /* Ensure the zoom overlay is on top of everything */
  .medium-zoom-overlay, .medium-zoom-image--opened {
    z-index: 9999 !important;
  }
  
  img, .mermaid svg {
    cursor: zoom-in;
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    // Attach to standard images immediately
    mediumZoom('img', {
      margin: 24,
      background: '#2d2d2d',
      scrollOffset: 0
    });
  });
</script>

<script type="module">
  import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
  mermaid.initialize({ startOnLoad: false });

  document.addEventListener('DOMContentLoaded', () => {
    const mermaidBlocks = document.querySelectorAll('pre code.language-mermaid');
    mermaidBlocks.forEach((block) => {
      const content = block.textContent;
      const div = document.createElement('div');
      div.className = 'mermaid';
      div.textContent = content;
      block.parentElement.replaceWith(div);
    });
    
    mermaid.run().then(() => {
      // Wait for Mermaid to fully render the SVGs
      setTimeout(() => {
        // Attach zoom to the generated SVGs
        mediumZoom('.mermaid svg', {
          margin: 24,
          background: '#2d2d2d',
          scrollOffset: 0
        });
      }, 1500); // Increased delay to 1.5s to be safe
    });
  });
</script>

<!-- MathJax Configuration -->
<script>
  MathJax = {
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']],
      displayMath: [['$$', '$$'], ['\\[', '\\]']],
      processEscapes: true,
      processEnvironments: true
    },
    options: {
      skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre']
    }
  };
</script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
